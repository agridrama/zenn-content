---
title: "Remote Procedure Call (RPC) (分散システム入門 2)"
emoji: "🙌"
topics: [分散システム, go, RPC]
published: false
---
:::message
この記事は勉強中の内容をoutputのために書き出したものです。誤りがないように気をつけていますが、もし記述に問題がある場合はご教示いただけると幸いです。
:::
## RPCとは何か？
以前インターン先でgRPCというものがマイクロサービス間通信で便利らしいと聞いたことがありましたが、そもそもRPCとは何なのでしょうか？
RPC (Remote Procedure Call) とは、ネットワーク越しの処理を関数呼び出しの形で**抽象(モデル化)**したものです。
呼び出し側は、引数/戻り値の型を意識するだけで、あたかもローカル関数を呼び出しているかのように振る舞うことができます。
ただし、RPCはモデルであり単一のプロトコルではなく、様々な実装が存在します。プログラミング言語依存のものもあれば、言語非依存のものもあります。
最初に例に挙げたgRPCはGoogleが開発したRPCフレームワークで、Protocol Buffersをデフォルトのインターフェース定義言語(IDL)として使用し、言語非依存の実装となっています。

### REST/RMIとの比較
API設計のスタイルとして広く使われているRESTもネットワーク越しの操作を抽象化したものですが、どのようにRPCと異なるのでしょうか？
RESTはリモートのリソースを操作することに焦点を当てており、CRUD (Create, Read, Update, Delete) をHTTPメソッド (POST, GET, PUT, DELETE) にマッピングしています。つまり、RESTはリソース指向であり、操作はリソースの状態に基づいています。一方で、RPCは関数を呼び出すことに焦点を当てており、操作は関数の引数と戻り値に基づいています。
また、Java RMI (Remote Method Invocation) はJava言語に特化したRPCと言えますが、リモートのJavaオブジェクトのメソッドを呼び出すための仕組みを提供します。RPCはより一般的な概念であり、RMIはその一つの実装例です。

## なぜRPCを使うのか

## どうRPCが実現されるのか

まずは具体的な分散システムとしてClient-Serverモデルを考えます。
ClientがServerに対してリクエストを送り、Serverがそれに応じてレスポンスを返すという形態です。
この時,ClientとServerではどのようなことが行われているかを考えます。簡単には以下のような処理が必要になります。

- Clientは送信先のServerを特定し、リクエストメッセージを送る
- リクエスト/レスポンスメッセージをエンコード/デコードする
- Serverは適切なClientにレスポンスを返す
- Clientがレスポンスを受け取る

しかし、もし以下のようなことが起こったらどうなるでしょうか？
- リクエストメッセージが途中でlostする
- Serverでいつ処理が完了するかわからない
- レスポンスメッセージが途中でlostする

Clientがこれらの問題を把握できるかどうかはわかりません。したがって、解決策として、リクエストの再送やタイムアウトの設定が行われます。しかし、これらの対策でも防げないような問題があるのは明らかです。
そこで、冪等操作(idempotent operation)

## まとめ

## 参考記事
記事を執筆する際に以下の記事を参照しました。
https://qiita.com/mmake/items/7d4bfb45c3aa8b34a983
https://aws.amazon.com/jp/compare/the-difference-between-rpc-and-rest/
